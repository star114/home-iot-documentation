# 홈 IOT 시스템 기록 문서

## IOT 플랫폼?

* 구글 홈
* 애플 홈킷
* 삼성 스마트싱스
* 샤오미 미홈
* 홈어시스턴트
* 투야
* 허비탯
* 피바로
* ...

삼성 스마트싱스, 홈어시스턴트 - 오픈 플랫폼
구글 홈, 애플 홈킷, 샤오미 미홈, 투야 - 폐쇄 플랫폼

폐쇄 플랫폼의 경우 비교적 간단하게 제품의 연결, 유지가 가능하지만 지원하는 디바이스 외의 다른 제품을 해당 플랫폼으로 연동하기 어렵습니다.
저의 경우 오픈 플랫폼을 선택했고, 처음엔 스마트싱스 기반으로 시작해서 지금은 홈 어시스턴트를 구축했습니다.

=> 오픈 플랫폼이 유지보수 노력이 좀 더 들긴 하지만 유저가 많아 문제 공유가 잘 되고 해결책을 찾는 것도 생각보다 그리 어렵진 않아요.

오픈플랫폼의 경우 추가적으로 몇가지 작업을 하면 대부분의 기기 정보를 다른 폐쇄 플랫폼으로 넘겨서 모두 사용이 가능합니다.

예시)
* 홈 어시스턴트 -> 구글홈/애플 홈킷/스마트싱스
* 스마트싱스 -> 홈 어시스턴트/애플 홈킷/구글홈

## Zigbee vs Wifi vs Zwave

IOT 제품들은 기본적으로 network 를 통해 해당 플랫폼으로 연결 되어 있어야 하는데, 이를 위한 통신 방식이 여러가지 존재.

Wifi 는 별도의 coordinator 없이 직접 네트웍에 접근하는 방식으로 추가 장비가 필요하지 않아 초기 진입장벽이 낮음.
다만 보통 wifi router 가 지원하는 최대 연결 가능 장치가 제한이 있고 연결 된 장비가 많으면 라우터에 과부하가 걸리기 쉬워 홈 네트웍에 접근해야 하는 다른 장치들 (폰, 노트북 등) 의 네트웍 성능에도 영향을 끼칠 수 있음.

Zwave/Zigbee 는 별도의 미리 정의된 통신 방식이기 때문에 기기에서 오는 정보를 다시 네트웍의 플랫폼으로 보내주려면 중간 다리에 해당하는 coordinator 가 필요함.
Zwave 는 국가별로 다른 주파수 대역을 사용, 해외 제품 사용 시 유의 필요.
Zigbee 의 경우는 세계 공통이라 해외 iot 제품을 사용했을때 문제 없이 호환 가능. 다만 wifi 와 대역을 공유하기 때문에 이를 충분히 인지하고 네트웍 대역과 겹치지 않게 구성하여야 함.

예시)

스마트싱스

* zigbee 장비 - zigbee coordinator (스마트싱스 허브) - 스마트싱스 서버
* zwave 장비 - zwave coordinator (스마트싱스 허브) - 스마트싱스 서버
* Wifi 장비 (삼성 제품) - 집 wifi 에 직접 연결 - 스마트싱스 서버
* Wifi 장비 (그외 제품) - 집 wifi 에 직접 연결 - 외부 서버 (제품 제조사 서버) - 스마트싱스 서버

홈 어시스턴트

* zigbee 장비 - zigbee coordinator (cc2538, ... 별도 구매) - 개인 서버 (별도 구매)
* zwave 장비 - zwave coordinator (별도 구매) - 개인 서버
* Wifi 장비 (로컬 연동 가능한 제품) - 집 wifi에 연결 - 개인 서버
* Wifi 장비 (로컬 연동 불가능한 제품) - 집 wifi에 연결 - 외부 서버 (제품 제조사 서버) - 개인 서버

### Zigbee Router vs End device

난 Zigbee를 메인으로 선택했기에 추가 정보를 남김.

Zigbee coordinator랑 모든 디바이스를 바로 연결하면 좋겠지만 coordinator의 성능에 따라 최대 연결 가능 갯수의 제한이 있다.
보통은 바로 연결할 제품 갯수랑 Router 를 통해 연결할 제품 갯수가 서로 다르게 정의 된다.

또한 coordinator 와 제품 간의 거리가 멀면 신호가 약해져서 (마치 공유기에서 멀어지면 와이파이가 점점 약해지는 원리와 같다) 그 중간 매개체가 필요해 지는데,
Router 역할을 할 수 있는 제품을 중간 중간 배치해 주어야 누락되는 신호없이 coordinator가 정보를 잘 받을 수 있다.

End device 는 라우터 기능이 없는 제품을 의미한다.

### 로컬 vs 리모트

로컬은 외부 네트웍을 통하지 않고 홈 네트웍 내에서 모든 작업이 일어나는 것을 의미.

리모트의 경우 외부 네트웍 으로 외부 서버를 들러 다시 내부로 돌아오는 일련의 과정을 의미.

## 사용중인 제품

- wifi mesh network 구성 - iptime 제품 3개로 전체 커버.
- 라이브러리
    - 스마트 싱스 허브 (zigbee 25번 채널) => cc2538 (zigbee 25번 채널)
    - 스위치 3구 (헤이홈 3선식, zigbee, router)
        - 1구는 전체 조명으로 사용 (자동화로 구현)
    - 로보락 s5max (로보락, wifi)
    - 구글 홈 미니 스피커 (구글, wifi)
    - 다목적 센서 (스마트싱스, zigbee)
    - 누수 센서 (tuya, zigbee)
    - 지그비 멀티탭 (Lellki, zigbee, router)
    - 모션 센서 (스마트싱스, zigbee)
- 드레스룸
    - 스위치 1구 (헤이홈 3선식, zigbee, router)
    - 온습도 (헤이홈, zigbee)
    - 다목적 센서 (스마트싱스, zigbee)
    - 스마트 플러그 (다원, zigbee, router)
    - 모션 센서 (스마트싱스, zigbee)
- 화장실
    - 스위치 3구 (헤이홈 3선식, zigbee, router) (환풍기 처럼 전기를 많이 필요로 하는 제품의 경우 스위치의 허용 전력을 확인해보아야 함)
    - 다목적 센서 (스마트싱스, zigbee)
    - 스마트 플러그 (다원, zigbee, router)
    - 온습도 (헤이홈, zigbee)
    - 모션 센서 (스마트싱스, zigbee)
    - 누수 센서 (tuya, zigbee)
- 안방
    - 스위치 3구 (헤이홈 3선식, zigbee, router)
    - 스위치 3구 침대옆 (헤이홈 3선식, zigbee, router)
        - 1구는 전체 조명으로 사용 (자동화로 구현)
    - 하모니 허브 (로지텍, wifi) - 만능리모컨 (ir): 리모컨을 지원하는 구형 제품 조작용.
    - 구글 홈 미니 스피커 (구글, wifi)
    - 온습도 (헤이홈, zigbee)
    - 다목적 센서 (스마트싱스, zigbee)
    - 스마트 플러그 (다원, zigbee, end device)
    - 스마트 플러그 (다원, zigbee, router)
    - 모션 센서 (필립스 휴, zigbee)
    - 공기청정기 (삼성, wifi)
- 주방
    - 스위치 3구 (헤이홈 3선식, zigbee, router)
    - 스위치 3구 (헤이홈 3선식, zigbee, router)
    - 삼성 갤럭시 홈 미니 (삼성, wifi)
        - IR 기능 존재 - 구형 에어컨 조작용
    - 스마트 플러그 (다원, zigbee, end device)
    - 스마트 플러그 (다원, zigbee, router)
    - 누수 센서 (tuya, zigbee)
    - 모션 센서 (스마트싱스, zigbee)
- 베란다
    - 스위치 3구 (헤이홈 3선식, zigbee, router)
    - 건조기 (삼성, wifi)
    - 다목적 센서 (스마트싱스, zigbee)
    - 누수 센서 (tuya, zigbee)
    - 모션 센서 (스마트싱스, zigbee)
- 입구
    - 다목적 센서 (스마트싱스, zigbee)
    - 도어락 SHP-DP960 (삼성 sds, wifi) - 스마트싱스랑 연동은 되지만 홈 어시스턴트로 정보를 못 읽어옴.

## 장치의 조작 - 자동화

장치들을 플랫폼에 등록하면 해당 플랫폼의 앱으로 각각의 장치의 정보를 얻을 수 있고 일반적으로 조작도 가능하다.
매번 앱을 실행해서 조작하는 건 귀찮으므로 두가지 방식을 추가적으로 사용하게 되는데

1) 스마트 스피커 (구글의 홈 미니, 네스트 미니, 네스트, 애플의 홈팟, 홈팟 미니, 삼성의 갤럭시 홈 미니 등) 를 사용하여 제어 명령을 내린다.
  예시) 오케이 구글, 청소기 켜줘, 주방 조명 꺼줘, 취침 모드....
2) 대부분의 경우 조건에 맞춰 자동화를 만들 수 있다. (훨씬 편리함)

## 고려/추가 가능?

- 수전 잠금장치
- 연기 감지기/화재 감지기
- 도어벨
- 가습기 자동 물채우기
- 식물 물 주기
- 구글 네스트 서모 스탯
- 월패드의 rs485 통신 하이잭을 통한 모든 장비 조작 (아마 가장 쉬운 방법일듯)
- 열회수 환기시스템
- 차고문 자동 여닫기
- 창문 자동 여닫기

## 추천 영상

* 오날도의 스마트홈 만들기
* 슬기로운 가정생활
* Ray's 스마트홈
